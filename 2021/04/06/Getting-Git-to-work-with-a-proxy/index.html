<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="Background前期大部分的项目代码仓库都在 Bitbucket 上，直接使用了 Bitbucket 的 pipelines 做 CI&#x2F;CD。虽然贵了点，但还是挺方便的。 但随着我们自身 DevOps 需求的不断增加，我们也逐渐基于 Jenkins+Argo 搭建了一整套自己的 DevOps 平台。 同时由于 Bitbucket 经常网络抽风，所以从去年起我们逐步将代码迁移到了 Github。">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Benjamin Says">
<meta property="og:type" content="article">
<meta property="og:title" content="Getting Git to work with a proxy">
<meta property="og:url" content="https://benwk.com/2021/04/06/Getting-Git-to-work-with-a-proxy/index.html">
<meta property="og:site_name" content="Benjamin Says">
<meta property="og:description" content="Background前期大部分的项目代码仓库都在 Bitbucket 上，直接使用了 Bitbucket 的 pipelines 做 CI&#x2F;CD。虽然贵了点，但还是挺方便的。 但随着我们自身 DevOps 需求的不断增加，我们也逐渐基于 Jenkins+Argo 搭建了一整套自己的 DevOps 平台。 同时由于 Bitbucket 经常网络抽风，所以从去年起我们逐步将代码迁移到了 Github。">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-04-06T10:04:19.000Z">
<meta property="article:modified_time" content="2021-04-08T14:30:21.202Z">
<meta property="article:author" content="benwk">
<meta property="article:tag" content="Proxy">
<meta property="article:tag" content="Clash">
<meta property="article:tag" content="Git">
<meta property="article:tag" content="代理">
<meta property="article:tag" content="翻墙">
<meta property="article:tag" content="科学上网">
<meta name="twitter:card" content="summary">
    
    
      
        
          
            <link rel="shortcut icon" href="https://www.gravatar.com/avatar/d1f994ff37fe4ba0cd9f56871f3f8255?s=48">
          
        
      
      
        
          
            <link rel="icon" type="image/png" href="https://www.gravatar.com/avatar/d1f994ff37fe4ba0cd9f56871f3f8255?s=192" sizes="192x192">
          
        
      
      
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="https://www.gravatar.com/avatar/d1f994ff37fe4ba0cd9f56871f3f8255?s=180">
          
        
      
    
    <!-- title -->
    <title>Getting Git to work with a proxy</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
<meta name="generator" content="Hexo 4.2.1"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="https://github.com/benwk" target="_blank" rel="noopener">Projects</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" href="/2020/01/14/Kubernetes-Ingress-Nginx-Rewrite-non-www-to-www/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://benwk.com/2021/04/06/Getting-Git-to-work-with-a-proxy/" target="_blank" rel="noopener"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://benwk.com/2021/04/06/Getting-Git-to-work-with-a-proxy/&text=Getting Git to work with a proxy" target="_blank" rel="noopener"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://benwk.com/2021/04/06/Getting-Git-to-work-with-a-proxy/&title=Getting Git to work with a proxy" target="_blank" rel="noopener"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://benwk.com/2021/04/06/Getting-Git-to-work-with-a-proxy/&is_video=false&description=Getting Git to work with a proxy" target="_blank" rel="noopener"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Getting Git to work with a proxy&body=Check out this article: https://benwk.com/2021/04/06/Getting-Git-to-work-with-a-proxy/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://benwk.com/2021/04/06/Getting-Git-to-work-with-a-proxy/&title=Getting Git to work with a proxy" target="_blank" rel="noopener"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://benwk.com/2021/04/06/Getting-Git-to-work-with-a-proxy/&title=Getting Git to work with a proxy" target="_blank" rel="noopener"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://benwk.com/2021/04/06/Getting-Git-to-work-with-a-proxy/&title=Getting Git to work with a proxy" target="_blank" rel="noopener"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://benwk.com/2021/04/06/Getting-Git-to-work-with-a-proxy/&title=Getting Git to work with a proxy" target="_blank" rel="noopener"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://benwk.com/2021/04/06/Getting-Git-to-work-with-a-proxy/&name=Getting Git to work with a proxy&description=" target="_blank" rel="noopener"><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=https://benwk.com/2021/04/06/Getting-Git-to-work-with-a-proxy/&t=Getting Git to work with a proxy" target="_blank" rel="noopener"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Background"><span class="toc-number">1.</span> <span class="toc-text">Background</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#搭建梯子"><span class="toc-number">2.</span> <span class="toc-text">搭建梯子</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用-Clash-客户端"><span class="toc-number">3.</span> <span class="toc-text">使用 Clash 客户端</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#安装客户端"><span class="toc-number">3.1.</span> <span class="toc-text">安装客户端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置梯子"><span class="toc-number">3.2.</span> <span class="toc-text">配置梯子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#测试服务器"><span class="toc-number">3.3.</span> <span class="toc-text">测试服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置规则（组）"><span class="toc-number">3.4.</span> <span class="toc-text">配置规则（组）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置代理端口"><span class="toc-number">3.5.</span> <span class="toc-text">配置代理端口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#终端使用代理"><span class="toc-number">4.</span> <span class="toc-text">终端使用代理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Git-使用代理"><span class="toc-number">5.</span> <span class="toc-text">Git 使用代理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#使用-git-config"><span class="toc-number">5.1.</span> <span class="toc-text">使用 git config</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用-SSH-协议"><span class="toc-number">5.2.</span> <span class="toc-text">使用 SSH 协议</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IDE-使用代理"><span class="toc-number">6.</span> <span class="toc-text">IDE 使用代理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#VS-Code"><span class="toc-number">6.1.</span> <span class="toc-text">VS Code</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Jetbrains"><span class="toc-number">6.2.</span> <span class="toc-text">Jetbrains</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Getting Git to work with a proxy
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">benwk</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2021-04-06T10:04:19.000Z" itemprop="datePublished">2021-04-06</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/Clash/" rel="tag">Clash</a>, <a class="tag-link" href="/tags/Git/" rel="tag">Git</a>, <a class="tag-link" href="/tags/Proxy/" rel="tag">Proxy</a>, <a class="tag-link" href="/tags/%E4%BB%A3%E7%90%86/" rel="tag">代理</a>, <a class="tag-link" href="/tags/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/" rel="tag">科学上网</a>, <a class="tag-link" href="/tags/%E7%BF%BB%E5%A2%99/" rel="tag">翻墙</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h2><p>前期大部分的项目代码仓库都在 <a href="https://bitbucket.org" target="_blank" rel="noopener">Bitbucket</a> 上，直接使用了 Bitbucket 的 <a href="https://bitbucket.org/product/features/pipelines" target="_blank" rel="noopener">pipelines</a> 做 CI/CD。虽然贵了点，但还是挺方便的。</p>
<p>但随着我们自身 DevOps 需求的不断增加，我们也逐渐基于 Jenkins+Argo 搭建了一整套自己的 DevOps 平台。</p>
<p>同时由于 Bitbucket 经常网络抽风，所以从去年起我们逐步将代码迁移到了 <a href="https://github.com" target="_blank" rel="noopener">Github</a>。悲催的是，Github 也被 <a href="https://twitter.com/williamlong/status/1373096436187811842" target="_blank" rel="noopener">重点关照</a> 了……</p>
<blockquote>
<p>据 blocky 统计，Github 从 2 月 27 日开始至今都被中国屏蔽。</p>
</blockquote>
<p>开发团队小伙伴们更是苦不堪言，拉取/提交代码速度只有字节的痛苦可想而知。虽然团队已经购买了不少梯子，但在实际使用中又会因为不同协议和软件的问题，导致了挺多问题。</p>
<p>这里相对系统的记录一下通用配置和场景：</p>
<ul>
<li><del>搭建梯子</del></li>
<li>使用 Clash 客户端</li>
<li>终端使用代理</li>
<li>Git 使用代理</li>
<li>IDE 使用代理</li>
</ul>
<h2 id="搭建梯子"><a href="#搭建梯子" class="headerlink" title="搭建梯子"></a><del>搭建梯子</del></h2><p>搭建梯子的方式有很多，自建和购买都很方便，此处略过。</p>
<p>推荐词汇：<code>v2net</code>，<code>AAEX</code></p>
<h2 id="使用-Clash-客户端"><a href="#使用-Clash-客户端" class="headerlink" title="使用 Clash 客户端"></a>使用 Clash 客户端</h2><p>可以使用的客户端有很多，个人比较喜欢 Clash，在此就以 Clash 举例。</p>
<h3 id="安装客户端"><a href="#安装客户端" class="headerlink" title="安装客户端"></a>安装客户端</h3><p>Clash 在不同系统下需要下载不同的客户端，直接在 Github 的 release 中下载：</p>
<ul>
<li>Mac 客户端：<a href="https://github.com/yichengchen/clashX/releases" target="_blank" rel="noopener">https://github.com/yichengchen/clashX/releases</a></li>
<li>Windows 客户端：<a href="https://github.com/Fndroid/clash_for_windows_pkg/releases" target="_blank" rel="noopener">https://github.com/Fndroid/clash_for_windows_pkg/releases</a></li>
</ul>
<p>下载安装后设置为开机启动即可。</p>
<h3 id="配置梯子"><a href="#配置梯子" class="headerlink" title="配置梯子"></a>配置梯子</h3><p>一般而言，购买梯子后会提供不同的订阅方式给不同的客户端用户，常用的包含 SS/SSR、Clash 和 Surge 等等。我们这里选择 Clash 的链接复制.</p>
<p>如果是 Mac 客户端，则通过以下路径打开配置：<code>Config - Remote Config - Manage - Add</code>，Url 中粘贴订阅链接，Name 可以自定义方便后面选择。</p>
<p>如果是 Windows 客户端，则通过一下路径打开配置：<code>Dashboard - Profiles - Download from a URL</code>，粘贴订阅链接并下载，</p>
<p>添加完成后，打开 Dashboard - Proxies 可以看到当前订阅的所有服务器节点。</p>
<h3 id="测试服务器"><a href="#测试服务器" class="headerlink" title="测试服务器"></a>测试服务器</h3><p>由于节点服务器一般不够稳定，可以通过 Speed Test / Benchmark 功能测试节点连接情况，选择最优节点进行连接。</p>
<p>选择好节点后，打开 <code>使用系统代理</code> 或 <code>Set as system proxy</code> 即可实现科学上网。</p>
<p><em>注：在 Proxy Mode 中有三个选项 Rule、Global 和 Direct，分别代表按照规则使用代理、全局使用代理和不实用代理。因此，可以长期将 Clash 设置为系统代理并通过以上三个选项来控制本机的网络使用。</em></p>
<h3 id="配置规则（组）"><a href="#配置规则（组）" class="headerlink" title="配置规则（组）"></a>配置规则（组）</h3><p>一般而言，Proxy Mode 选择 Rule 即可，默认配置会自动判断哪些流程需要走代理。如果遇到一些抽风，可以临时打开 Global 来执行代理。</p>
<p>但有时我们也希望可以精细配置，Mac 客户端可以通过以下路径打开配置文件所在目录：<code>Config - open local config Folder</code>，找到正在使用的配置文件并打开。Windows 客户端更方便一些，既可以通过以下路径：<code>Dashboard - Profiles</code> 选中配置文件后 <code>Edit in text mode</code>，也可以直接 <code>Edit rules</code> 进行可视化编辑。</p>
<p>配置文件中会包含以下配置，可以实现自定义：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 节点配置</span></span><br><span class="line"><span class="attr">proxies:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">测试节点1.0</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ss</span></span><br><span class="line">  <span class="attr">server:</span> <span class="string">cn-1.benwk.io</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">560</span></span><br><span class="line">  <span class="attr">cipher:</span> <span class="string">rc4-md5</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">XXXXXXXXXXXXXXXXXX</span></span><br><span class="line">  <span class="attr">plugin:</span> <span class="string">obfs</span></span><br><span class="line">  <span class="attr">plugin-opts:</span></span><br><span class="line">    <span class="attr">mode:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">13442</span><span class="string">-Y0j1J96peu.download.microsoft.com</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">测试节点2.0</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ss</span></span><br><span class="line">  <span class="attr">server:</span> <span class="string">cn-2.benwk.io</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">560</span></span><br><span class="line">  <span class="attr">cipher:</span> <span class="string">rc4-md5</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">XXXXXXXXXXXXXXXXXX</span></span><br><span class="line">  <span class="attr">plugin:</span> <span class="string">obfs</span></span><br><span class="line">  <span class="attr">plugin-opts:</span></span><br><span class="line">    <span class="attr">mode:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">13442</span><span class="string">-Y0j1J96peu.download.microsoft.com</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 代理组配置，用于自定义代理组来优化流量路径。</span></span><br><span class="line"><span class="attr">proxy-groups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Default</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">select</span></span><br><span class="line">    <span class="attr">proxies:</span></span><br><span class="line">       <span class="string">["测试节点1.0","测试节点2.0"]</span></span><br><span class="line">  <span class="comment"># 配置 Youtube 组用于将所有 Youtube 流量指向对应的优化节点</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">YouTube</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">select</span></span><br><span class="line">    <span class="attr">proxies:</span></span><br><span class="line">      <span class="string">["Default","测试节点1.0","测试节点2.0"]</span></span><br><span class="line">  <span class="comment"># 配置 BiliBili 组用于将所有 BiliBili 流量跳过代理直连网络</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">BiliBili</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">select</span></span><br><span class="line">    <span class="attr">proxies:</span></span><br><span class="line">      <span class="string">["DIRECT","代理","测试节点1.0","测试节点2.0"]</span></span><br><span class="line">  <span class="comment"># 配置 规则外 组用于将所有其他流量指向对应节点，或直接指向 代理 组</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">规则外路由选择</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">select</span></span><br><span class="line">    <span class="attr">proxies:</span></span><br><span class="line">      <span class="string">["Default","DIRECT","测试节点1.0","测试节点2.0"]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 规则配置，用于通过规则过滤将流量应用代理或代理组</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"> <span class="comment"># 域名后缀匹配，指向直连</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,local,DIRECT</span></span><br><span class="line"> <span class="comment"># IPv4 匹配</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">IP-CIDR,192.168.0.0/16,DIRECT,no-resolve</span></span><br><span class="line"> <span class="comment"># IPv6 匹配</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">IP-CIDR6,fd00::/8,DIRECT,no-resolve</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,17gouwuba.com,REJECT</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">IP-CIDR,39.107.15.115/32,REJECT,no-resolve</span></span><br><span class="line"> <span class="comment"># 域名关键字匹配，指向 Youtube 代理组</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">DOMAIN-KEYWORD,youtube,YouTube</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,youtu.be,YouTube</span></span><br><span class="line"> <span class="comment"># 域名后缀匹配，指向 Default 代理组</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">DOMAIN-SUFFIX,himalaya.com,Default</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></table></figure>
<p>其中规则支持以下类型：</p>
<ul>
<li>DOMAIN-SUFFIX：域名后缀匹配</li>
<li>DOMAIN：域名匹配</li>
<li>DOMAIN-KEYWORD：域名关键字匹配</li>
<li>IP-CIDR：IP 段匹配</li>
<li>SRC-IP-CIDR：源 IP 段匹配</li>
<li>GEOIP：GEOIP 数据库（国家代码）匹配</li>
<li>DST-PORT：目标端口匹配</li>
<li>SRC-PORT：源端口匹配</li>
<li>PROCESS-NAME：源进程名匹配</li>
<li>RULE-SET：Rule Provider 规则匹配</li>
<li>MATCH：全匹配</li>
</ul>
<h3 id="配置代理端口"><a href="#配置代理端口" class="headerlink" title="配置代理端口"></a>配置代理端口</h3><p>Clash 也自带了代理端口的配置，允许其他程序通过代理端口访问网络，默认端口配置是 <code>7890</code>，为 HTTP 和 SOCKS5 的混合端口。</p>
<ul>
<li>Mac 客户端可以通过 <code>Dashboard - Setting - Mixed proxy port</code> 进行配置。</li>
<li>Windows 客户端可以通过 <code>Dashboard - General - Port</code> 进行配置。</li>
</ul>
<p><em>注：此处不建议修改，容易造成端口冲突</em></p>
<h2 id="终端使用代理"><a href="#终端使用代理" class="headerlink" title="终端使用代理"></a>终端使用代理</h2><p>一般而言，终端 Terminal 如果想使用代理会需要独立的配置，Clash 也比较方便的生成了命令。</p>
<p>Mac 客户端可以在菜单栏点击 <code>Copy shell command</code> 来复制终端代理命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Bash</span></span><br><span class="line">$ <span class="built_in">export</span> https_proxy=http://127.0.0.1:7890 http_proxy=http://127.0.0.1:7890 all_proxy=socks5://127.0.0.1:7890</span><br></pre></td></tr></table></figure>

<p>Windows 客户端可以通过 <code>Dahsboard - General - Port</code> 点击终端图标进行各种终端代理命令的复制。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Powershell</span></span><br><span class="line"><span class="variable">$</span> <span class="variable">$Env:http_proxy</span>=<span class="string">"http://127.0.0.1:7890"</span>;<span class="variable">$Env:https_proxy</span>=<span class="string">"http://127.0.0.1:7890"</span></span><br></pre></td></tr></table></figure>

<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">REM CMD</span></span><br><span class="line">$ <span class="built_in">set</span> http_proxy=http://<span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">7890</span> &amp; <span class="built_in">set</span> https_proxy=http://<span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">7890</span></span><br></pre></td></tr></table></figure>

<p>我们也可以将命令配置成别名作为快捷使用，以 Mac 下的 ohmyzsh 为例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打开文件</span></span><br><span class="line">$ vi ~/.zshrc</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在文件尾部添加</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 大多数情况可以直接使用 socks5 协议</span></span><br><span class="line"><span class="built_in">alias</span> setproxy=<span class="string">"export all_proxy=socks5://127.0.0.1:7890"</span></span><br><span class="line"><span class="comment"># 对于有些工具会禁止使用 socks5，可以切换为 http 协议</span></span><br><span class="line"><span class="built_in">alias</span> setproxyhttp=<span class="string">"export all_proxy=http://127.0.0.1:7890"</span></span><br><span class="line"><span class="comment"># 移除所有代理配置，恢复直连</span></span><br><span class="line"><span class="built_in">alias</span> unsetproxy=<span class="string">"unset all_proxy"</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 保存后执行</span></span><br><span class="line">$ <span class="built_in">source</span> ~/.zshrc</span><br></pre></td></tr></table></figure>

<p>这样我们就可以直接使用 <code>setproxy</code>、<code>setproxyhttp</code> 和 <code>unsetproxy</code> 来控制终端中的代理配置。</p>
<h2 id="Git-使用代理"><a href="#Git-使用代理" class="headerlink" title="Git 使用代理"></a>Git 使用代理</h2><p>在 Git 的使用上，每个人的使用途径和软件都会有比较大的差异。因此，这里我们只在一些常规的用法上举例说明如何让 Git 流量走代理路径。</p>
<h3 id="使用-git-config"><a href="#使用-git-config" class="headerlink" title="使用 git config"></a>使用 git config</h3><p>大多数教程中使用 <code>git config</code> 命令来配置代理，但不知道什么原因我自己没有成功。这里只记录一下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过 http 端口配置</span></span><br><span class="line">$ git config --global http.proxy <span class="string">'http://127.0.0.1:7890'</span></span><br><span class="line">$ git config --global https.proxy <span class="string">'http://127.0.0.1:7890'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过 socks5 端口位置</span></span><br><span class="line">$ git config --global http.proxy <span class="string">'socks5://127.0.0.1:7890'</span></span><br><span class="line">$ git config --global https.proxy <span class="string">'socks5://127.0.0.1:7890'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 取消 git 的代理配置</span></span><br><span class="line">$ git config --global --<span class="built_in">unset</span> http.proxy</span><br><span class="line">$ git config --global --<span class="built_in">unset</span> https.proxy</span><br></pre></td></tr></table></figure>

<h3 id="使用-SSH-协议"><a href="#使用-SSH-协议" class="headerlink" title="使用 SSH 协议"></a>使用 SSH 协议</h3><p>个人比较习惯使用 SSH 协议使用 Git，对于 SSH 的配置这里不再赘述，可以参考 <a href="https://docs.github.com/cn/github/authenticating-to-github/connecting-to-github-with-ssh" target="_blank" rel="noopener">Github SSH 配置文档</a>。</p>
<p>首先验证本机 SSH 是否有权限访问仓库：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 验证 Github</span></span><br><span class="line">$ ssh git@github.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证 Bitbucket</span></span><br><span class="line">$ ssh git@bitbucket.org</span><br></pre></td></tr></table></figure>

<p>返回成功信息即配置成功，接着打开 SSH 的配置文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打开或新建 SSH 配置文件</span></span><br><span class="line">$ vi ~/.ssh/config</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Host *</span><br><span class="line">  AddKeysToAgent yes</span><br><span class="line">  UseKeychain yes</span><br><span class="line">  IdentityFile ~&#x2F;.ssh&#x2F;id_rsa</span><br><span class="line"></span><br><span class="line">Host github.com</span><br><span class="line">  User git</span><br><span class="line">  ProxyCommand nc -x 127.0.0.1:7890 %h %p</span><br><span class="line"></span><br><span class="line">Host bitbucket.org</span><br><span class="line">  User git</span><br><span class="line">  ProxyCommand nc -x 127.0.0.1:7890 %h %p</span><br><span class="line"></span><br><span class="line">Host benwk-io</span><br><span class="line">  HostName xxx.xx.xx.xxx</span><br><span class="line">  User root</span><br><span class="line">  Port 22</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 保存后立即生效</span></span><br></pre></td></tr></table></figure>

<p>其中：</p>
<ul>
<li>Host * 段落是访问所有服务器 SSH 密钥配置</li>
<li>Host github.com 段落是配置代理访问 Github</li>
<li>Host bitbucket.org 段落是配置代理访问 Bitbucket</li>
<li>Host benwk-io 段落是自定义访问服务器</li>
</ul>
<p><em>注：在节点服务器出现异常时，可以直接设置 Clash 直连，避免频繁修改 SSH 这里的 config 文件</em></p>
<h2 id="IDE-使用代理"><a href="#IDE-使用代理" class="headerlink" title="IDE 使用代理"></a>IDE 使用代理</h2><p>有些小伙伴也会使用编辑器插件或 IDE 自带工具进行 Git 管理，这里只记录一下常用的 VS Code 和 Jetbrains 的配置方法。</p>
<h3 id="VS-Code"><a href="#VS-Code" class="headerlink" title="VS Code"></a>VS Code</h3><p>打开 VS Code 的 settings.json 并添加：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"http.proxy"</span>: <span class="string">"http://127.0.0.1:7890"</span>,</span><br><span class="line">  <span class="attr">"https.proxy"</span>: <span class="string">"http://127.0.0.1:7890"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>保存后即可生效。</p>
<h3 id="Jetbrains"><a href="#Jetbrains" class="headerlink" title="Jetbrains"></a>Jetbrains</h3><p>所有 Jetbrains 系列软件都是类似的配置方法，包括 IDEA、WebStorm、PyCharm 和 Android Studio 等等。它们都是需要独立配置的，包括 Toolbox 也可以独立配置代理。</p>
<p>IDE 里所有的配置都可以通过 <code>Preference - Appearance &amp; Behavior - System Settings - HTTP Proxy - Manual proxy configuration</code> 设置。</p>
<p>同样可以选择 HTTP 或 SOCK5，<code>Host name</code> 都是 <code>127.0.0.1</code>，<code>Port number</code> 是 <code>7890</code>。</p>
<p>这里也可以设置 <code>No proxy for</code> 来过滤一些流量不走代理，不过如果我们已经在 Clash 配置过一些规则，这里不用重复设置。</p>
<p>对于 Toolbox 则在设置中配置 <code>127.0.0.1:7890</code> 即可。</p>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="https://github.com/benwk" target="_blank" rel="noopener">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Background"><span class="toc-number">1.</span> <span class="toc-text">Background</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#搭建梯子"><span class="toc-number">2.</span> <span class="toc-text">搭建梯子</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用-Clash-客户端"><span class="toc-number">3.</span> <span class="toc-text">使用 Clash 客户端</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#安装客户端"><span class="toc-number">3.1.</span> <span class="toc-text">安装客户端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置梯子"><span class="toc-number">3.2.</span> <span class="toc-text">配置梯子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#测试服务器"><span class="toc-number">3.3.</span> <span class="toc-text">测试服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置规则（组）"><span class="toc-number">3.4.</span> <span class="toc-text">配置规则（组）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置代理端口"><span class="toc-number">3.5.</span> <span class="toc-text">配置代理端口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#终端使用代理"><span class="toc-number">4.</span> <span class="toc-text">终端使用代理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Git-使用代理"><span class="toc-number">5.</span> <span class="toc-text">Git 使用代理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#使用-git-config"><span class="toc-number">5.1.</span> <span class="toc-text">使用 git config</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用-SSH-协议"><span class="toc-number">5.2.</span> <span class="toc-text">使用 SSH 协议</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IDE-使用代理"><span class="toc-number">6.</span> <span class="toc-text">IDE 使用代理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#VS-Code"><span class="toc-number">6.1.</span> <span class="toc-text">VS Code</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Jetbrains"><span class="toc-number">6.2.</span> <span class="toc-text">Jetbrains</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://benwk.com/2021/04/06/Getting-Git-to-work-with-a-proxy/" target="_blank" rel="noopener"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://benwk.com/2021/04/06/Getting-Git-to-work-with-a-proxy/&text=Getting Git to work with a proxy" target="_blank" rel="noopener"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://benwk.com/2021/04/06/Getting-Git-to-work-with-a-proxy/&title=Getting Git to work with a proxy" target="_blank" rel="noopener"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://benwk.com/2021/04/06/Getting-Git-to-work-with-a-proxy/&is_video=false&description=Getting Git to work with a proxy" target="_blank" rel="noopener"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Getting Git to work with a proxy&body=Check out this article: https://benwk.com/2021/04/06/Getting-Git-to-work-with-a-proxy/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://benwk.com/2021/04/06/Getting-Git-to-work-with-a-proxy/&title=Getting Git to work with a proxy" target="_blank" rel="noopener"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://benwk.com/2021/04/06/Getting-Git-to-work-with-a-proxy/&title=Getting Git to work with a proxy" target="_blank" rel="noopener"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://benwk.com/2021/04/06/Getting-Git-to-work-with-a-proxy/&title=Getting Git to work with a proxy" target="_blank" rel="noopener"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://benwk.com/2021/04/06/Getting-Git-to-work-with-a-proxy/&title=Getting Git to work with a proxy" target="_blank" rel="noopener"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://benwk.com/2021/04/06/Getting-Git-to-work-with-a-proxy/&name=Getting Git to work with a proxy&description=" target="_blank" rel="noopener"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=https://benwk.com/2021/04/06/Getting-Git-to-work-with-a-proxy/&t=Getting Git to work with a proxy" target="_blank" rel="noopener"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2021
    benwk
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="https://github.com/benwk" target="_blank" rel="noopener">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-154985907-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-154985907-1');
    </script>

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'benwk';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


</body>
</html>
